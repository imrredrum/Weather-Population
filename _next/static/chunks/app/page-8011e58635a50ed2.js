(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{22408:(e,t,r)=>{Promise.resolve().then(r.bind(r,80314))},80314:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>N});var n=r(95155),a=r(53267),i=r(7068),s=r(700),l=r(67978),o=r(43786);let c=e=>{let{defaultValue:t,onSubmit:r,error:c}=e;return(0,n.jsxs)(a.A,{children:[(0,n.jsxs)(a.A,{component:"form",action:e=>{r({city:e.get("city"),country:e.get("country")})},sx:{display:"flex",flexDirection:{xs:"column",sm:"row"},flexWrap:"wrap",alignItems:{xs:"flex-start",sm:"center"},gap:2},children:[(0,n.jsxs)(i.default,{direction:"row",alignItems:"center",spacing:2,sx:{width:{xs:1,sm:"auto"}},children:[(0,n.jsx)(s.default,{children:"City"}),(0,n.jsx)(l.A,{name:"city",size:"small",variant:"outlined",defaultValue:null==t?void 0:t.city,required:!0,error:c,sx:{width:132,flexGrow:1}})]}),(0,n.jsxs)(i.default,{direction:"row",alignItems:"center",spacing:2,sx:{width:{xs:1,sm:"auto"}},children:[(0,n.jsx)(s.default,{children:"Country"}),(0,n.jsx)(l.A,{name:"country",size:"small",variant:"outlined",defaultValue:null==t?void 0:t.country,error:c,sx:{width:132,flexGrow:1}})]}),(0,n.jsx)(o.A,{size:"small",variant:"contained",type:"submit",color:"primary",autoCapitalize:"off",sx:{height:40,px:5.5},children:"Search"})]}),c&&(0,n.jsx)(s.default,{variant:"caption",color:"error.main",sx:{mt:1.5,ml:5},children:"Not found the city or country"})]})};var d=r(23464);let u=async(e,t)=>{let{arg:r}=t;return await d.A.get("https://api.openweathermap.org/data/2.5/weather?q=London,uk&appid=".concat(r)),r};var m=r(93720),h=r(34727),x=r(28991),p=r(12115),f=r(64088);let g=()=>{let{enqueueSnackbar:e}=(0,x.dh)(),t=(0,m.E)(e=>e.update),[r,i]=(0,p.useState)(!1),{isMutating:s,trigger:c}=(0,f.A)("validateToken",u,{onSuccess:r=>{i(!1),t(r),e("API token set successfully!",{variant:"success"})},onError:t=>{var r;(null==(r=t.response)?void 0:r.status)===401&&e("Invalid API token. Please set a valid token.",{variant:"error"}),i(!0)}});return(0,n.jsxs)(a.A,{component:"form",action:e=>{c(e.get("token"))},sx:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:2},children:[(0,n.jsx)(l.A,{name:"token",size:"small",label:"OpenWeather API Key",variant:"outlined",required:!0,disabled:s,error:r,sx:{width:224}}),(0,n.jsx)(o.A,{size:"small",variant:"contained",type:"submit",color:"primary",loading:s,sx:{height:40,px:5.5},children:"Set"}),(0,n.jsx)(o.A,{size:"small",variant:"text",title:"Get Token",href:"https://openweathermap.org/price#free",target:"_blank",endIcon:(0,n.jsx)(h.A,{}),sx:{height:40},children:"Get Token"})]})};var y=r(12630),j=r(92577),w=r(61129),v=r(41218),z=r(16632),A=r(14426),b=r(8154),k=r(96169),I=r.n(k),S=r(30832),C=r.n(S),P=r(66766);C().extend(I());let E={sameDay:"[Today] h:mm A",nextDay:"[Tomorrow] h:mm A",nextWeek:"dddd h:mm A",lastDay:"[Yesterday] h:mm A",lastWeek:"[Last] dddd h:mm A",sameElse:"DD/MM/YYYY"},_=e=>{let{weather:t,loading:r}=e;return(0,n.jsx)(v.default,{variant:"outlined",sx:{width:1,maxWidth:540},children:(0,n.jsx)(z.default,{sx:{p:4,minHeight:387,display:"flex",flexDirection:"column",":last-child":{pb:4}},children:r?(0,n.jsx)(i.default,{flexGrow:1,justifyContent:"center",alignItems:"center",children:(0,n.jsx)(A.A,{color:"primary",size:128,thickness:1.5})}):t?(0,n.jsxs)(b.A,{container:!0,spacing:2,children:[(0,n.jsx)(b.A,{size:6,children:(0,n.jsxs)(i.default,{direction:"row",alignItems:"center",spacing:.5,color:"primary.main",children:[(0,n.jsx)(y.default,{}),(0,n.jsx)(s.default,{fontSize:"1.25rem",fontWeight:"bold",children:t.city})]})}),(0,n.jsx)(b.A,{size:6,children:(0,n.jsx)(s.default,{color:"primary.main",textAlign:"right",children:C()().calendar(C()(t.datetime),E)})}),(0,n.jsx)(b.A,{size:12,children:(0,n.jsxs)(i.default,{direction:{sm:"row"},justifyContent:"center",alignItems:"center",spacing:1.5,sx:{aspectRatio:{sm:"2 / 1"}},children:[(0,n.jsx)(a.A,{width:{xs:200,sm:128},sx:{aspectRatio:"1 / 1",position:"relative"},children:(0,n.jsx)(P.default,{fill:!0,src:"https://openweathermap.org/img/wn/".concat(t.iconCode,"@4x.png"),alt:"weather-icon",style:{objectFit:"cover"},priority:!0,sizes:"(max-width: 600px) 200px, 128px"})}),(0,n.jsxs)(i.default,{spacing:.25,color:"primary.main",width:{xs:1,sm:"auto"},children:[(0,n.jsxs)(s.default,{fontSize:"4rem",lineHeight:"4.625rem",children:[t.temperature,"℃"]}),(0,n.jsx)(s.default,{fontSize:"1.5rem",lineHeight:"1.75rem",children:t.title}),(0,n.jsx)(s.default,{children:t.description})]})]})}),(0,n.jsx)(b.A,{size:{xs:12,sm:"auto"},children:(0,n.jsxs)(i.default,{direction:"row",alignItems:"center",spacing:.5,color:"primary.main",children:[(0,n.jsx)(j.A,{}),(0,n.jsxs)(s.default,{children:["Humidity: ",t.humidity,"%"]})]})}),(0,n.jsx)(b.A,{size:{xs:12,sm:"grow"},children:(0,n.jsxs)(i.default,{direction:"row",justifyContent:{sm:"flex-end"},alignItems:"center",spacing:.5,color:"primary.main",children:[(0,n.jsx)(w.A,{}),(0,n.jsxs)(s.default,{children:["Temperature ",t.temperatureRange.min,"℃ ~"," ",t.temperatureRange.max,"℃"]})]})})]}):(0,n.jsx)(i.default,{flexGrow:1,justifyContent:"center",alignItems:"center",children:"No Data"})})})};var T=r(71153);T.z.object({city:T.z.string(),country:T.z.string()});let D=T.z.object({city:T.z.string(),code:T.z.number().int(),title:T.z.string(),description:T.z.string(),iconCode:T.z.string(),temperature:T.z.number(),temperatureRange:T.z.object({min:T.z.number(),max:T.z.number()}),humidity:T.z.number().int().min(0).max(100),datetime:T.z.coerce.date()}),R=T.z.object({weather:T.z.array(T.z.object({id:T.z.number().int(),main:T.z.string(),description:T.z.string(),icon:T.z.string()})),main:T.z.object({temp:T.z.number(),temp_min:T.z.number(),temp_max:T.z.number(),humidity:T.z.number().int().min(0).max(100)}),dt:T.z.number(),name:T.z.string()}),W=e=>{let t={city:e.name,code:e.weather[0].id,title:e.weather[0].main,description:e.weather[0].description,iconCode:e.weather[0].icon,temperature:e.main.temp,temperatureRange:{min:e.main.temp_min,max:e.main.temp_max},humidity:e.main.humidity,datetime:new Date(1e3*e.dt)},r=D.safeParse(t);return r.success?r.data:void console.error("Resolved data structure is invalid:","\n",r.error.flatten().fieldErrors)},G=async e=>{let{data:t}=await d.A.get(e),r=R.safeParse(t);return r.success?W(r.data):void console.error("Respond structure is invalid:","\n",r.error.flatten().fieldErrors)};function N(){let{enqueueSnackbar:e}=(0,x.dh)(),{token:t,clear:r}=(0,m.E)(e=>e),[a,l]=(0,p.useState)({city:"",country:""}),[o,d]=(0,p.useState)(null),[u,h]=(0,p.useState)(!1),{isMutating:y,trigger:j}=(0,f.A)("https://api.openweathermap.org/data/2.5/weather?q=".concat(a.city,",").concat(a.country,"&units=metric&appid=").concat(t),G,{onSuccess:t=>{if(h(!1),!t){e("No weather data returned.",{variant:"info"}),d(null);return}d(t)},onError:t=>{var n;switch(null==(n=t.response)?void 0:n.status){case 401:e("Invalid API token. Please set a valid token.",{variant:"error"}),r();break;case 404:e("Cannot find the city or country. Please try another city or country.",{variant:"error"}),h(!0);break;default:e("Failed to fetch weather data. Please try again.",{variant:"error"})}d(null)}});return(0,p.useEffect)(()=>{a.city&&t&&j()},[a,t,j]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.default,{variant:"h1",gutterBottom:!0,children:"Today’s Weather"}),!t&&(0,n.jsx)(g,{}),!!t&&(0,n.jsxs)(i.default,{spacing:4,children:[(0,n.jsx)(c,{defaultValue:a,onSubmit:e=>{l(e)},error:u}),(0,n.jsx)(_,{weather:o,loading:y})]})]})}},93720:(e,t,r)=>{"use strict";r.d(t,{TokenStoreProvider:()=>u,E:()=>m});var n=r(95155),a=r(12421);let i=()=>({token:localStorage.getItem("weatherApiKey")}),s={token:null},l=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s;return(0,a.y)()(t=>({...e,update:e=>(null===e?localStorage.removeItem("weatherApiKey"):localStorage.setItem("weatherApiKey",e),t({token:e})),clear:()=>(localStorage.removeItem("weatherApiKey"),t(e))}))};var o=r(12115),c=r(65521);let d=(0,o.createContext)(null),u=e=>{let{children:t}=e,r=(0,o.useRef)(null);return null===r.current&&(r.current=l()),(0,o.useEffect)(()=>{var e;null==(e=r.current)||e.setState(i())},[]),(0,n.jsx)(d.Provider,{value:r.current,children:t})},m=e=>{let t=(0,o.useContext)(d);if(!t)throw Error("useTokenStore must be used within TokenStoreProvider");return(0,c.P)(t,e)}}},e=>{var t=t=>e(e.s=t);e.O(0,[975,401,78,441,684,358],()=>t(22408)),_N_E=e.O()}]);